<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Uniswap Whitepaper-cn | 0xOne1eaF's Blog Post</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"é”®å…¥ä»¥ç»§ç»­","blurHolder":"æ•°æ®æ£€ç´¢","noResult":"æ—  $0 ç›¸å…³æ•°æ®"},"code":{"codeInfo":"$0 - $1 è¡Œ","copy":"å¤åˆ¶"}}</script><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><script src="//unpkg.com/mermaid@10.5.0/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
 --light-background: url('/img/bk.jpg');
 --theme-encrypt-confirm: 'ç¡®è®¤'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@10.5.0/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.busuanzi'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="æ•°æ®æ£€ç´¢" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>Uniswap Whitepaper-cn</h1><div id="post-info"><span>æ–‡ç« å‘å¸ƒæ—¶é—´: <div class="control"><time datetime="2024-11-27T16:00:00.000Z" id="date"> 2024-11-28</time></div></span><br><span>æœ€åæ›´æ–°æ—¶é—´: <div class="control"><time datetime="2024-11-27T18:43:39.106Z" id="updated"> 2024-11-28</time></div></span></div></div><hr><div id="post-content"><h1 id="Uniswap-whitepaper"><a href="#Uniswap-whitepaper" class="headerlink" title="Uniswap whitepaper"></a>Uniswap whitepaper</h1><blockquote>
<p>ç”±äºåŸç‰ˆçš„uniswapç™½çš®ä¹¦æ˜¯å…¨è‹±æ–‡çš„ï¼Œé˜…è¯»èµ·æ¥å¯èƒ½ç¨æ˜¾å›°éš¾ï¼Œæ‰€ä»¥æˆ‘æ‹¿chatgptç¿»è¯‘äº†ä¸€ä¸‹ï¼ˆå¹¶éæœºç¿»ï¼‰ï¼Œæ–¹ä¾¿ä»¥åè§‚çœ‹</p>
<p>ä¸‹é¢æ˜¯æ­£æ–‡</p>
</blockquote>
<hr>
<h2 id="Gas-åŸºå‡†ï¼ˆGas-Benchmarksï¼‰"><a href="#Gas-åŸºå‡†ï¼ˆGas-Benchmarksï¼‰" class="headerlink" title="Gas åŸºå‡†ï¼ˆGas Benchmarksï¼‰"></a>Gas åŸºå‡†ï¼ˆGas Benchmarksï¼‰</h2><p>ç”±äºå…¶æç®€çš„è®¾è®¡ï¼ŒUniswap çš„ Gas ä½¿ç”¨éå¸¸é«˜æ•ˆã€‚å¯¹äº ETH ä¸ ERC20 çš„äº¤æ˜“ï¼Œå®ƒä½¿ç”¨çš„ Gas æ¯” Bancor å°‘äº†è¿‘ 10 å€ã€‚ç›¸æ¯” 0xï¼ŒUniswap åœ¨ ERC20 â†” ERC20 çš„äº¤æ˜“ä¸­ä¹Ÿè¡¨ç°å¾—æ›´ä¸ºé«˜æ•ˆï¼Œå¹¶ä¸”ä¸åŸºäºé“¾ä¸Šçš„è®¢å•ç°¿äº¤æ˜“æ‰€ï¼ˆå¦‚ EtherDelta å’Œ IDEXï¼‰ç›¸æ¯”ï¼ŒUniswap æ˜¾è‘—å‡å°‘äº† Gas æ¶ˆè€—ã€‚</p>
<h4 id="äº¤æ˜“å¹³å°-Gas-æ¶ˆè€—å¯¹æ¯”è¡¨"><a href="#äº¤æ˜“å¹³å°-Gas-æ¶ˆè€—å¯¹æ¯”è¡¨" class="headerlink" title="äº¤æ˜“å¹³å° Gas æ¶ˆè€—å¯¹æ¯”è¡¨"></a><strong>äº¤æ˜“å¹³å° Gas æ¶ˆè€—å¯¹æ¯”è¡¨</strong></h4><table>
<thead>
<tr>
<th><strong>äº¤æ˜“ç±»å‹</strong></th>
<th><strong>Uniswap</strong></th>
<th><strong>EtherDelta</strong></th>
<th><strong>Bancor</strong></th>
<th><strong>Radar Relay (0x)</strong></th>
<th><strong>IDEX</strong></th>
<th><strong>Airswap</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ETH â†” ERC20</td>
<td>46,000</td>
<td>108,000</td>
<td>440,000</td>
<td>113,000*</td>
<td>143,000</td>
<td>90,000</td>
</tr>
<tr>
<td>ERC20 â†” ETH</td>
<td>60,000</td>
<td>93,000</td>
<td>403,000</td>
<td>113,000*</td>
<td>143,000</td>
<td>120,000*</td>
</tr>
<tr>
<td>ERC20 â†” ERC20</td>
<td>88,000</td>
<td>ä¸æ”¯æŒ</td>
<td>538,000</td>
<td>113,000*</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
</tbody></table>
<p><code>*</code>: ä½¿ç”¨å°è£…çš„ ETHï¼ˆwrapped ETHï¼‰ã€‚<br><strong>æ³¨</strong>ï¼šåœ¨ Uniswap ä¸Šï¼Œç›´æ¥è½¬ç§» ERC20 ä»£å¸çš„ Gas æˆæœ¬ä¸º 36,000ï¼Œæ¯” ETH â†” ERC20 äº¤æ˜“èŠ‚çœäº†å¤§çº¦ 20%ã€‚</p>
<hr>
<h2 id="åˆ›å»ºäº¤æ˜“å¯¹ï¼ˆCreating-Exchangesï¼‰"><a href="#åˆ›å»ºäº¤æ˜“å¯¹ï¼ˆCreating-Exchangesï¼‰" class="headerlink" title="åˆ›å»ºäº¤æ˜“å¯¹ï¼ˆCreating Exchangesï¼‰"></a>åˆ›å»ºäº¤æ˜“å¯¹ï¼ˆCreating Exchangesï¼‰</h2><p><code>uniswap_factory.vy</code> æ˜¯ä¸€ä¸ªæ™ºèƒ½åˆçº¦ï¼Œä½œä¸º Uniswap äº¤æ˜“æ‰€çš„å·¥å‚å’Œæ³¨å†Œè¡¨ã€‚<code>createExchange()</code> å…¬å…±å‡½æ•°å…è®¸ä»»ä½•ä»¥å¤ªåŠç”¨æˆ·ä¸ºå°šæœªæ‹¥æœ‰äº¤æ˜“å¯¹çš„ ERC20 ä»£å¸éƒ¨ç½²æ–°çš„äº¤æ˜“åˆçº¦ã€‚</p>
<h4 id="æ ¸å¿ƒä»£ç ç¤ºä¾‹"><a href="#æ ¸å¿ƒä»£ç ç¤ºä¾‹" class="headerlink" title="æ ¸å¿ƒä»£ç ç¤ºä¾‹"></a><strong>æ ¸å¿ƒä»£ç ç¤ºä¾‹</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">exchangeTemplate: public(address)</span><br><span class="line">token_to_exchange: address[address]</span><br><span class="line">exchange_to_token: address[address]</span><br><span class="line"></span><br><span class="line"><span class="meta">@public</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">template: address</span>):</span><br><span class="line">    <span class="variable language_">self</span>.exchangeTemplate = template</span><br><span class="line"></span><br><span class="line"><span class="meta">@public</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createExchange</span>(<span class="params">token: address</span>) -&gt; address:</span><br><span class="line">    <span class="keyword">assert</span> <span class="variable language_">self</span>.token_to_exchange[token] == ZERO_ADDRESS</span><br><span class="line">    new_exchange: address = create_with_code_of(<span class="variable language_">self</span>.exchangeTemplate)</span><br><span class="line">    <span class="variable language_">self</span>.token_to_exchange[token] = new_exchange</span><br><span class="line">    <span class="variable language_">self</span>.exchange_to_token[new_exchange] = token</span><br><span class="line">    <span class="keyword">return</span> new_exchange</span><br></pre></td></tr></table></figure>

<p>åˆçº¦ä¼šè®°å½•æ¯ä¸ªä»£å¸åŠå…¶å…³è”çš„äº¤æ˜“å¯¹åœ°å€ã€‚é€šè¿‡ä»£å¸åœ°å€æˆ–äº¤æ˜“å¯¹åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡½æ•°ç›¸äº’æŸ¥è¯¢ï¼š</p>
<ul>
<li><code>getExchange(token: address) -&gt; address</code>ï¼šæ ¹æ®ä»£å¸åœ°å€æŸ¥è¯¢äº¤æ˜“å¯¹åœ°å€ã€‚</li>
<li><code>getToken(exchange: address) -&gt; address</code>ï¼šæ ¹æ®äº¤æ˜“å¯¹åœ°å€æŸ¥è¯¢ä»£å¸åœ°å€ã€‚</li>
</ul>
<p><strong>é™åˆ¶</strong>ï¼šå·¥å‚åˆçº¦ä»…ç¡®ä¿æ¯ç§ä»£å¸åªèƒ½æœ‰ä¸€ä¸ªäº¤æ˜“å¯¹ï¼ˆone-exchange-per-tokenï¼‰ã€‚ç”¨æˆ·éœ€è¦è‡ªè¡Œç¡®ä¿äº¤æ˜“å¯¹çš„å¯é æ€§ã€‚</p>
<hr>
<h2 id="ETH-â‡„-ERC20-äº¤æ˜“ï¼ˆETH-to-ERC20-Tradesï¼‰"><a href="#ETH-â‡„-ERC20-äº¤æ˜“ï¼ˆETH-to-ERC20-Tradesï¼‰" class="headerlink" title="ETH â‡„ ERC20 äº¤æ˜“ï¼ˆETH to ERC20 Tradesï¼‰"></a>ETH â‡„ ERC20 äº¤æ˜“ï¼ˆETH to ERC20 Tradesï¼‰</h2><p>æ¯ä¸ªäº¤æ˜“åˆçº¦ï¼ˆ<code>uniswap_exchange.vy</code>ï¼‰ä¸ä¸€ä¸ª ERC20 ä»£å¸ç»‘å®šï¼Œå¹¶ç»´æŒç€ ETH å’Œè¯¥ä»£å¸çš„æµåŠ¨æ€§æ± ã€‚ETH å’Œ ERC20 ä¹‹é—´çš„æ±‡ç‡åŸºäºå®ƒä»¬åœ¨åˆçº¦å†…æµåŠ¨æ€§æ± çš„ç›¸å¯¹å¤§å°ï¼Œé€šè¿‡ä»¥ä¸‹å…¬å¼ä¿æŒï¼š</p>
<p>ethpoolâˆ—tokenpool&#x3D;invarianteth_pool * token_pool &#x3D; invariant ethpoolâˆ—tokenpool&#x3D;invariant</p>
<h4 id="ETH-è½¬-ERC20-ç¤ºä¾‹ä»£ç "><a href="#ETH-è½¬-ERC20-ç¤ºä¾‹ä»£ç " class="headerlink" title="ETH è½¬ ERC20 ç¤ºä¾‹ä»£ç "></a><strong>ETH è½¬ ERC20 ç¤ºä¾‹ä»£ç </strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">eth_pool: uint256         </span><br><span class="line">token_pool: uint256       </span><br><span class="line">token: address(ERC20) </span><br><span class="line"></span><br><span class="line"><span class="meta">@public</span></span><br><span class="line"><span class="meta">@payable</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ethToTokenSwap</span>():</span><br><span class="line">    fee: uint256 = msg.value / <span class="number">500</span> </span><br><span class="line">    invariant: uint256 = <span class="variable language_">self</span>.eth_pool * <span class="variable language_">self</span>.token_pool</span><br><span class="line">    new_eth_pool: uint256 = <span class="variable language_">self</span>.eth_pool + msg.value</span><br><span class="line">    new_token_pool: uint256 = invariant / (new_eth_pool - fee)</span><br><span class="line">    tokens_out: uint256 = <span class="variable language_">self</span>.token_pool - new_token_pool</span><br><span class="line">    <span class="variable language_">self</span>.eth_pool = new_eth_pool</span><br><span class="line">    <span class="variable language_">self</span>.token_pool = new_token_pool</span><br><span class="line">    <span class="variable language_">self</span>.token.transfer(msg.sender, tokens_out)</span><br></pre></td></tr></table></figure>

<p>äº¤æ˜“é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”¨æˆ·å‘ <code>ethToTokenSwap()</code> å‘é€ ETHã€‚</li>
<li>ETH æ± ï¼ˆ<code>eth_pool</code>ï¼‰å¢åŠ ï¼Œä¸ºä¿æŒæ’å®šä¹˜ç§¯ï¼Œä»£å¸æ± ï¼ˆ<code>token_pool</code>ï¼‰æŒ‰æ¯”ä¾‹å‡å°‘ã€‚</li>
<li>å‡å°‘çš„ä»£å¸é‡å³ä¸ºç”¨æˆ·è´­ä¹°çš„ä»£å¸æ•°é‡ï¼ŒåŒæ—¶æ‰£é™¤æ‰‹ç»­è´¹ï¼ˆ0.2%ï¼‰ã€‚</li>
</ol>
<p><strong>Gas ä¼˜åŒ–</strong>ï¼š<br><code>eth_pool</code> å’Œ <code>token_pool</code> çš„å‚¨å¤‡é‡å¹¶ä¸æ˜¯å­˜å‚¨å˜é‡ï¼Œè€Œæ˜¯é€šè¿‡ <code>self.balance</code> å’Œä»£å¸åˆçº¦çš„ä½™é¢åŠ¨æ€è·å–ã€‚</p>
<hr>
<h2 id="ERC20-è½¬-ETH-äº¤æ˜“ï¼ˆERC20-to-ETH-Tradesï¼‰"><a href="#ERC20-è½¬-ETH-äº¤æ˜“ï¼ˆERC20-to-ETH-Tradesï¼‰" class="headerlink" title="ERC20 è½¬ ETH äº¤æ˜“ï¼ˆERC20 to ETH Tradesï¼‰"></a>ERC20 è½¬ ETH äº¤æ˜“ï¼ˆERC20 to ETH Tradesï¼‰</h2><p><code>tokenToEthSwap()</code> å‡½æ•°ç”¨äºå°† ERC20 ä»£å¸äº¤æ¢ä¸º ETHï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@public</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenToEthSwap</span>(<span class="params">tokens_in: uint256</span>):</span><br><span class="line">    fee: uint256 = tokens_in / <span class="number">500</span></span><br><span class="line">    invariant: uint256 = <span class="variable language_">self</span>.eth_pool * <span class="variable language_">self</span>.token_pool</span><br><span class="line">    new_token_pool: uint256 = <span class="variable language_">self</span>.token_pool + tokens_in</span><br><span class="line">    new_eth_pool: uint256 = <span class="variable language_">self</span>.invariant / (new_token_pool - fee)</span><br><span class="line">    eth_out: uint256 = <span class="variable language_">self</span>.eth_pool - new_eth_pool</span><br><span class="line">    <span class="variable language_">self</span>.eth_pool = new_eth_pool</span><br><span class="line">    <span class="variable language_">self</span>.token_pool = new_token_pool</span><br><span class="line">    <span class="variable language_">self</span>.token.transferFrom(msg.sender, <span class="variable language_">self</span>, tokens_in)</span><br><span class="line">    send(msg.sender, eth_out)</span><br></pre></td></tr></table></figure>

<p>è¯¥æ“ä½œä¸ <code>ethToTokenSwap()</code> çš„æ“ä½œç±»ä¼¼ï¼š</p>
<ol>
<li>ç”¨æˆ·å‘åˆçº¦å‘é€ ERC20 ä»£å¸ã€‚</li>
<li>ä»£å¸æ± ï¼ˆ<code>token_pool</code>ï¼‰å¢åŠ ï¼Œè€Œ ETH æ± ï¼ˆ<code>eth_pool</code>ï¼‰å‡å°‘ã€‚</li>
<li>ETH æ± å‡å°‘çš„ ETH æ•°é‡å³ä¸ºç”¨æˆ·å…‘æ¢çš„ ETHã€‚</li>
</ol>
<hr>
<h3 id="ETH-åˆ°-OMG-ç¤ºä¾‹äº¤æ˜“"><a href="#ETH-åˆ°-OMG-ç¤ºä¾‹äº¤æ˜“" class="headerlink" title="ETH åˆ° OMG ç¤ºä¾‹äº¤æ˜“"></a><strong>ETH åˆ° OMG ç¤ºä¾‹äº¤æ˜“</strong></h3><p>å½“ç”¨æˆ·ç”¨ ETH è´­ä¹° OMG æ—¶ï¼ŒETH æ± ä¼šå¢åŠ ï¼ŒOMG æ± åˆ™ä¼šå‡å°‘ã€‚äº¤æ˜“ä¸­æ±‡ç‡çš„å˜åŒ–ä¿ƒä½¿å¸‚åœºè°ƒæ•´ï¼Œè¾¾åˆ°å¹³è¡¡çŠ¶æ€ã€‚</p>
<blockquote>
<p>å°æ€»ç»“ï¼šUniswap é€šè¿‡æ’å®šä¹˜ç§¯å…¬å¼å®ç°äº†ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„è‡ªåŠ¨åŒ–äº¤æ˜“ç³»ç»Ÿã€‚å…¶æç®€è®¾è®¡ç¡®ä¿äº†é«˜æ•ˆçš„ Gas ä½¿ç”¨ï¼Œå¹¶é€šè¿‡åŠ¨æ€è°ƒæ•´æ± ä¸­çš„èµ„äº§æ¯”ä¾‹æ¥å½±å“å¸‚åœºä»·æ ¼ï¼Œè¿›è€Œä¿ƒè¿›äº¤æ˜“å¹³è¡¡ã€‚äº¤æ˜“è¿‡ç¨‹ä¸­çš„ Gas ä¼˜åŒ–ä½¿å¾— Uniswap åœ¨å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ä¸­å…·å¤‡è¾ƒé«˜çš„ç«äº‰åŠ›ã€‚</p>
</blockquote>
<hr>
<h2 id="ERC20-â‡„-ERC20-äº¤æ˜“"><a href="#ERC20-â‡„-ERC20-äº¤æ˜“" class="headerlink" title="ERC20 â‡„ ERC20 äº¤æ˜“"></a>ERC20 â‡„ ERC20 äº¤æ˜“</h2><p>ç”±äº ETH è¢«ç”¨ä½œæ‰€æœ‰ ERC20 ä»£å¸çš„å…±åŒäº¤æ˜“å¯¹ï¼Œå®ƒå¯ä»¥ä½œä¸ºç›´æ¥è¿›è¡Œ ERC20 åˆ° ERC20 äº¤æ¢çš„ä¸­ä»‹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªäº¤æ˜“æ‰€å°† OMG è½¬æ¢ä¸º ETHï¼Œç„¶åå†åœ¨å¦ä¸€ä¸ªäº¤æ˜“æ‰€å°† ETH è½¬æ¢ä¸º KNCï¼Œåœ¨ä¸€æ¬¡äº¤æ˜“ä¸­å®Œæˆã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¦å°† OMG è½¬æ¢ä¸º KNCï¼Œä¹°å®¶åœ¨ OMG äº¤æ˜“åˆçº¦ä¸­è°ƒç”¨ <code>tokenToTokenSwap()</code> å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">contract Factory():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getExchange</span>(<span class="params">token_addr: address</span>) -&gt; address: constant</span><br><span class="line"></span><br><span class="line">contract Exchange():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ethToTokenTransfer</span>(<span class="params">recipent: address</span>) -&gt; <span class="built_in">bool</span>: modifying</span><br><span class="line">    </span><br><span class="line">factory: Factory</span><br><span class="line">    </span><br><span class="line"><span class="meta">@public</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenToTokenSwap</span>(<span class="params">token_addr: address, tokens_sold: uint256</span>):</span><br><span class="line">    exchange: address = <span class="variable language_">self</span>.factory.getExchange(token_addr)</span><br><span class="line">    fee: uint256 = tokens_sold / <span class="number">500</span></span><br><span class="line">    invariant: uint256 = <span class="variable language_">self</span>.eth_pool * <span class="variable language_">self</span>.token_pool</span><br><span class="line">    new_token_pool: uint256 = <span class="variable language_">self</span>.token_pool + tokens_sold</span><br><span class="line">    new_eth_pool: uint256 = invariant / (new_token_pool - fee)</span><br><span class="line">    eth_out: uint256 = <span class="variable language_">self</span>.eth_pool - new_eth_pool</span><br><span class="line">    <span class="variable language_">self</span>.eth_pool = new_eth_pool</span><br><span class="line">    <span class="variable language_">self</span>.token_pool = new_token_pool</span><br><span class="line">    Exchange(exchange).ethToTokenTransfer(msg.sender, value=eth_out)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>token_addr</code> æ˜¯ KNC ä»£å¸çš„åœ°å€ï¼Œ<code>tokens_sold</code> æ˜¯æ­£åœ¨å‡ºå”®çš„ OMG æ•°é‡ã€‚è¯¥å‡½æ•°é¦–å…ˆé€šè¿‡å·¥å‚è·å– KNC äº¤æ˜“æ‰€åœ°å€ã€‚æ¥ç€ï¼Œäº¤æ˜“æ‰€å°†è¾“å…¥çš„ OMG è½¬æ¢ä¸º ETHã€‚ä½†æ˜¯ï¼Œå‡½æ•°ä¸ä¼šå°†è´­ä¹°çš„ ETH è¿”å›ç»™ä¹°å®¶ï¼Œè€Œæ˜¯è°ƒç”¨ KNC äº¤æ˜“æ‰€ä¸­çš„ <code>ethToTokenTransfer()</code> å¯æ”¯ä»˜å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@public</span></span><br><span class="line"><span class="meta">@payable</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ethToTokenTransfer</span>(<span class="params">recipent: address</span>):</span><br><span class="line">    fee: uint256 = msg.value / <span class="number">500</span></span><br><span class="line">    invariant: uint256 = <span class="variable language_">self</span>.eth_pool * <span class="variable language_">self</span>.token_pool</span><br><span class="line">    new_eth_pool: uint256 = <span class="variable language_">self</span>.eth_pool + msg.value</span><br><span class="line">    new_token_pool: uint256 = invariant / (new_eth_pool - fee)</span><br><span class="line">    tokens_out: uint256 = <span class="variable language_">self</span>.token_pool - new_token_pool</span><br><span class="line">    <span class="variable language_">self</span>.eth_pool = new_eth_pool</span><br><span class="line">    <span class="variable language_">self</span>.token_pool = new_token_pool</span><br><span class="line">    <span class="variable language_">self</span>.invariant = new_eth_pool * new_token_pool</span><br><span class="line">    <span class="variable language_">self</span>.token.transfer(recipent, tokens_out)</span><br></pre></td></tr></table></figure>

<p><code>ethToTokenTransfer()</code> æ¥æ”¶ ETH å’Œä¹°å®¶åœ°å€ï¼ŒéªŒè¯è°ƒç”¨æ˜¯å¦æ¥è‡ªæ³¨å†Œçš„äº¤æ˜“æ‰€ï¼Œæ¥ç€å°† ETH è½¬æ¢ä¸º KNCï¼Œå¹¶å°† KNC è½¬å‘ç»™åŸå§‹ä¹°å®¶ã€‚<code>ethToTokenTransfer()</code> çš„åŠŸèƒ½ä¸ <code>ethToTokenSwap()</code> ç›¸åŒï¼Œä½†å®ƒå…·æœ‰é¢å¤–çš„è¾“å…¥å‚æ•° <code>recipient: address</code>ï¼Œç”¨äºå°†è´­ä¹°çš„ä»£å¸è½¬å‘ç»™åŸå§‹ä¹°å®¶ï¼Œè€Œä¸æ˜¯ <code>msg.sender</code>ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ <code>msg.sender</code> æ˜¯ OMG äº¤æ˜“æ‰€ã€‚</p>
<p>![](<a target="_blank" rel="noopener" href="https://imgur.com/HiHw6xL">Imgur: The magic of the Internet</a>)</p>
<h2 id="äº¤æ¢ä¸è½¬è´¦"><a href="#äº¤æ¢ä¸è½¬è´¦" class="headerlink" title="äº¤æ¢ä¸è½¬è´¦"></a>äº¤æ¢ä¸è½¬è´¦</h2><p><code>ethToTokenSwap()</code>ã€<code>tokenToEthSwap()</code> å’Œ <code>tokenToTokenSwap()</code> å‡½æ•°å°†è´­ä¹°çš„ä»£å¸è¿”å›åˆ°ä¹°å®¶çš„åœ°å€ã€‚</p>
<p><code>ethToTokenTransfer()</code>ã€<code>tokenToEthTransfer()</code> å’Œ <code>tokenToTokenTransfer()</code> å‡½æ•°å…è®¸ä¹°å®¶è¿›è¡Œäº¤æ˜“åï¼Œç«‹å³å°†è´­ä¹°çš„ä»£å¸è½¬ç§»åˆ°æŒ‡å®šçš„æ”¶æ¬¾åœ°å€ã€‚</p>
<hr>
<h2 id="æä¾›æµåŠ¨æ€§"><a href="#æä¾›æµåŠ¨æ€§" class="headerlink" title="æä¾›æµåŠ¨æ€§"></a>æä¾›æµåŠ¨æ€§</h2><h3 id="æ·»åŠ æµåŠ¨æ€§"><a href="#æ·»åŠ æµåŠ¨æ€§" class="headerlink" title="æ·»åŠ æµåŠ¨æ€§"></a>æ·»åŠ æµåŠ¨æ€§</h3><p>æ·»åŠ æµåŠ¨æ€§éœ€è¦å°†ç­‰å€¼çš„ ETH å’Œ ERC20 ä»£å¸å­˜å…¥ä¸ ERC20 ä»£å¸ç›¸å…³è”çš„äº¤æ˜“åˆçº¦ä¸­ã€‚</p>
<p>ç¬¬ä¸€ä¸ªåŠ å…¥æµåŠ¨æ± çš„æµåŠ¨æ€§æä¾›è€…é€šè¿‡å­˜å…¥ä»–ä»¬è®¤ä¸ºç­‰å€¼çš„ ETH å’Œ ERC20 ä»£å¸æ¥è®¾å®šåˆå§‹çš„äº¤æ˜“æ±‡ç‡ã€‚å¦‚æœè¿™ä¸ªæ¯”ä¾‹ä¸å¯¹ï¼Œå¥—åˆ©äº¤æ˜“è€…ä¼šé€šè¿‡å¥—åˆ©å°†ä»·æ ¼å¸¦å›å‡è¡¡ï¼Œåˆå§‹æµåŠ¨æ€§æä¾›è€…å°†æ‰¿æ‹…æŸå¤±ã€‚</p>
<p>æ‰€æœ‰æœªæ¥çš„æµåŠ¨æ€§æä¾›è€…éƒ½ä»¥ä»–ä»¬å­˜å…¥æ—¶çš„äº¤æ˜“æ±‡ç‡å­˜å…¥ ETH å’Œ ERC20 ä»£å¸ã€‚å¦‚æœäº¤æ˜“æ±‡ç‡ä¸åˆç†ï¼Œå¥—åˆ©è€…ä¼šé€šè¿‡å¥—åˆ©çº æ­£ä»·æ ¼ã€‚</p>
<h4 id="æµåŠ¨æ€§ä»£å¸"><a href="#æµåŠ¨æ€§ä»£å¸" class="headerlink" title="æµåŠ¨æ€§ä»£å¸"></a>æµåŠ¨æ€§ä»£å¸</h4><p>æµåŠ¨æ€§ä»£å¸æ˜¯ä¸ºäº†è¿½è¸ªæ¯ä¸ªæµåŠ¨æ€§æä¾›è€…è´¡çŒ®çš„æ€»å‚¨å¤‡æ¯”ä¾‹è€Œé“¸é€ çš„ã€‚å®ƒä»¬å¯ä»¥è¢«é«˜åº¦åˆ†å‰²ï¼Œå¹¶ä¸”å¯ä»¥éšæ—¶ç‡ƒçƒ§ä»¥é€€è¿˜æµåŠ¨æ€§å¸‚åœºçš„æŒ‰æ¯”ä¾‹ä»½é¢ã€‚</p>
<p>æµåŠ¨æ€§æä¾›è€…è°ƒç”¨ <code>addLiquidity()</code> å‡½æ•°å­˜å…¥å‚¨å¤‡å¹¶é“¸é€ æ–°çš„æµåŠ¨æ€§ä»£å¸ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@public</span></span><br><span class="line"><span class="meta">@payable</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addLiquidity</span>():</span><br><span class="line">    token_amount: uint256 = msg.value * token_pool / eth_pool </span><br><span class="line">    liquidity_minted: uint256 = msg.value * total_liquidity / eth_pool</span><br><span class="line">        </span><br><span class="line">    eth_added: uint256 = msg.value</span><br><span class="line">    shares_minted: uint256 = (eth_added * <span class="variable language_">self</span>.total_shares) / <span class="variable language_">self</span>.eth_pool</span><br><span class="line">    tokens_added: uint256 = (shares_minted * <span class="variable language_">self</span>.token_pool) / <span class="variable language_">self</span>.total_shares)</span><br><span class="line">    <span class="variable language_">self</span>.shares[msg.sender] = <span class="variable language_">self</span>.shares[msg.sender] + shares_minted</span><br><span class="line">    <span class="variable language_">self</span>.total_shares = <span class="variable language_">self</span>.total_shares + shares_minted</span><br><span class="line">    <span class="variable language_">self</span>.eth_pool = <span class="variable language_">self</span>.eth_pool + eth_added</span><br><span class="line">    <span class="variable language_">self</span>.token_pool = <span class="variable language_">self</span>.token_pool + tokens_added</span><br><span class="line">    <span class="variable language_">self</span>.token.transferFrom(msg.sender, <span class="variable language_">self</span>, tokens_added)</span><br></pre></td></tr></table></figure>

<p>é“¸é€ çš„æµåŠ¨æ€§ä»£å¸æ•°é‡ç”±å‘é€çš„ ETH æ•°é‡å†³å®šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š</p>
<p>amountMinted&#x3D;totalAmountâˆ—ethDepositedethPool\text{amountMinted} &#x3D; \text{totalAmount} * \frac{\text{ethDeposited}}{\text{ethPool}}amountMinted&#x3D;totalAmountâˆ—ethPoolethDeposited</p>
<p>å­˜å…¥ ETH åˆ°å‚¨å¤‡ä¸­åŒæ—¶éœ€è¦å­˜å…¥ç­‰å€¼çš„ ERC20 ä»£å¸ã€‚è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š</p>
<p>tokensDeposited&#x3D;tokenPoolâˆ—ethDepositedethPool\text{tokensDeposited} &#x3D; \text{tokenPool} * \frac{\text{ethDeposited}}{\text{ethPool}}tokensDeposited&#x3D;tokenPoolâˆ—ethPoolethDeposited</p>
<h3 id="ç§»é™¤æµåŠ¨æ€§"><a href="#ç§»é™¤æµåŠ¨æ€§" class="headerlink" title="ç§»é™¤æµåŠ¨æ€§"></a>ç§»é™¤æµåŠ¨æ€§</h3><p>æµåŠ¨æ€§æä¾›è€…å¯ä»¥éšæ—¶ç‡ƒçƒ§ä»–ä»¬çš„æµåŠ¨æ€§ä»£å¸ï¼Œæ’¤å›ä»–ä»¬åœ¨æµåŠ¨æ± ä¸­æŒ‰æ¯”ä¾‹çš„ ETH å’Œ ERC20 ä»£å¸ã€‚</p>
<p>ETH å’Œ ERC20 ä»£å¸æŒ‰å½“å‰çš„äº¤æ˜“æ±‡ç‡ï¼ˆå‚¨å¤‡æ¯”ä¾‹ï¼‰æ’¤å›ï¼Œè€Œä¸æ˜¯æŒ‰åŸå§‹æŠ•èµ„æ¯”ä¾‹ã€‚è¿™æ„å‘³ç€å¸‚åœºæ³¢åŠ¨å’Œå¥—åˆ©å¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†ä»·å€¼ä¸§å¤±ã€‚</p>
<p>äº¤æ˜“è¿‡ç¨‹ä¸­æ”¶å–çš„æ‰‹ç»­è´¹ä¼šç›´æ¥æ·»åŠ åˆ°æ€»æµåŠ¨æ€§æ± ä¸­ï¼Œè€Œä¸é“¸é€ æ–°çš„æµåŠ¨æ€§ä»£å¸ã€‚å› æ­¤ï¼Œ<code>ethWithdrawn</code> å’Œ <code>tokensWithdrawn</code> åŒ…å«è‡ªæµåŠ¨æ€§é¦–æ¬¡æ·»åŠ ä»¥æ¥æ”¶é›†çš„æ‰€æœ‰æ‰‹ç»­è´¹çš„æŒ‰æ¯”ä¾‹ä»½é¢ã€‚</p>
<h4 id="æµåŠ¨æ€§ä»£å¸-1"><a href="#æµåŠ¨æ€§ä»£å¸-1" class="headerlink" title="æµåŠ¨æ€§ä»£å¸"></a>æµåŠ¨æ€§ä»£å¸</h4><p>Uniswap æµåŠ¨æ€§ä»£å¸ä»£è¡¨æµåŠ¨æ€§æä¾›è€…åœ¨ ETH-ERC20 å¯¹ä¸­çš„è´¡çŒ®ã€‚å®ƒä»¬æœ¬èº«æ˜¯ ERC20 ä»£å¸ï¼Œå¹¶å®ç°äº†å®Œæ•´çš„ <a target="_blank" rel="noopener" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md">EIP-20</a> æ ‡å‡†ã€‚</p>
<p>è¿™å…è®¸æµåŠ¨æ€§æä¾›è€…å‡ºå”®ä»–ä»¬çš„æµåŠ¨æ€§ä»£å¸æˆ–åœ¨è´¦æˆ·ä¹‹é—´è½¬ç§»ï¼Œè€Œæ— éœ€ä»æµåŠ¨æ± ä¸­æ’¤å›æµåŠ¨æ€§ã€‚æµåŠ¨æ€§ä»£å¸æ˜¯ç‰¹å®šäºå•ä¸ª ETHâ‡„ERC20 äº¤æ˜“å¯¹çš„ã€‚æ­¤é¡¹ç›®æ²¡æœ‰ç»Ÿä¸€çš„ ERC20 ä»£å¸ã€‚</p>
<hr>
<h2 id="è´¹ç”¨ç»“æ„"><a href="#è´¹ç”¨ç»“æ„" class="headerlink" title="è´¹ç”¨ç»“æ„"></a>è´¹ç”¨ç»“æ„</h2><ul>
<li>ETH åˆ° ERC20 äº¤æ˜“<ul>
<li>è´¹ç”¨ä¸º 0.3% ä»¥ ETH æ”¯ä»˜</li>
</ul>
</li>
<li>ERC20 åˆ° ETH äº¤æ˜“<ul>
<li>è´¹ç”¨ä¸º 0.3% ä»¥ ERC20 ä»£å¸æ”¯ä»˜</li>
</ul>
</li>
<li>ERC20 åˆ° ERC20 äº¤æ˜“<ul>
<li>è´¹ç”¨ä¸º 0.3% ä»¥ ERC20 ä»£å¸æ”¯ä»˜ï¼Œç”¨äºè¾“å…¥äº¤æ˜“æ‰€çš„ ERC20 åˆ° ETH äº¤æ¢</li>
<li>è´¹ç”¨ä¸º 0.3% ä»¥ ETH æ”¯ä»˜ï¼Œç”¨äºè¾“å‡ºäº¤æ˜“æ‰€çš„ ETH åˆ° ERC20 äº¤æ¢</li>
<li>å®é™…ä¸Šæ˜¯ 0.5991% è´¹ç”¨ï¼ˆå¯¹äºè¾“å…¥çš„ ERC20ï¼‰</li>
</ul>
</li>
</ul>
<p>ETH ä¸ ERC20 ä»£å¸ä¹‹é—´çš„äº¤æ¢æ”¶å– 0.3% çš„è´¹ç”¨ã€‚è¯¥è´¹ç”¨ç”±æµåŠ¨æ€§æä¾›è€…æŒ‰å…¶å¯¹æµåŠ¨æ€§å‚¨å¤‡çš„è´¡çŒ®æ¯”ä¾‹è¿›è¡Œåˆ†é…ã€‚ç”±äº ERC20 åˆ° ERC20 äº¤æ˜“åŒ…æ‹¬ ERC20 åˆ° ETH äº¤æ¢å’Œ ETH åˆ° ERC20 äº¤æ¢ï¼Œå› æ­¤è´¹ç”¨ä¼šåœ¨ä¸¤ä¸ªäº¤æ˜“æ‰€æ”¯ä»˜ã€‚å¹³å°ä¸æ”¶å–å…¶ä»–è´¹ç”¨ã€‚</p>
<p>äº¤æ¢æ‰‹ç»­è´¹ä¼šç«‹å³å­˜å…¥æµåŠ¨æ€§å‚¨å¤‡ä¸­ã€‚ç”±äºæ²¡æœ‰é“¸é€ æ–°çš„æµåŠ¨æ€§ä»£å¸ï¼Œæ€»å‚¨å¤‡å¢åŠ ï¼Œå› æ­¤æ‰€æœ‰æµåŠ¨æ€§ä»£å¸çš„ä»·å€¼ä¼šå¹³å‡å¢åŠ ã€‚æ­¤åŠŸèƒ½ä½œä¸ºæµåŠ¨æ€§æä¾›è€…çš„æ”¯ä»˜ï¼Œå¯ä»¥é€šè¿‡é”€æ¯æµåŠ¨æ€§ä»£å¸æ¥æ”¶å›ã€‚</p>
<p>ç”±äºè´¹ç”¨è¢«æ·»åŠ åˆ°æµåŠ¨æ€§æ± ä¸­ï¼Œæ¯ç¬”äº¤æ˜“å <code>invariant</code> ä¼šå¢åŠ ã€‚åœ¨å•ä¸ªäº¤æ˜“ä¸­ï¼Œ<code>invariant</code> ä»£è¡¨ä¸Šä¸€ä¸ªäº¤æ˜“ç»“æŸæ—¶çš„ <code>eth_pool * token_pool</code>ã€‚</p>
<hr>
<h2 id="è‡ªå®šä¹‰æ± "><a href="#è‡ªå®šä¹‰æ± " class="headerlink" title="è‡ªå®šä¹‰æ± "></a>è‡ªå®šä¹‰æ± </h2><h3 id="ERC20-åˆ°äº¤æ˜“æ‰€"><a href="#ERC20-åˆ°äº¤æ˜“æ‰€" class="headerlink" title="ERC20 åˆ°äº¤æ˜“æ‰€"></a>ERC20 åˆ°äº¤æ˜“æ‰€</h3><p><code>tokenToExchangeSwap()</code> å’Œ <code>tokenToExchangeTransfer()</code> è¿™ä¸¤ä¸ªé¢å¤–çš„å‡½æ•°å¢åŠ äº† Uniswap çš„çµæ´»æ€§ã€‚è¿™äº›å‡½æ•°å°† ERC20 ä»£å¸è½¬æ¢ä¸º ETHï¼Œå¹¶åœ¨ç”¨æˆ·æŒ‡å®šçš„åœ°å€å°è¯•è¿›è¡Œ <code>ethToTokenTransfer()</code>ã€‚è¿™å…è®¸åœ¨ä¸åŒå·¥å‚ç”Ÿæˆçš„è‡ªå®šä¹‰ Uniswap äº¤æ˜“æ‰€</p>
<h2 id="é€‰æ‹©æ€§å‡çº§ï¼ˆOpt-in-Upgradesï¼‰"><a href="#é€‰æ‹©æ€§å‡çº§ï¼ˆOpt-in-Upgradesï¼‰" class="headerlink" title="é€‰æ‹©æ€§å‡çº§ï¼ˆOpt-in Upgradesï¼‰"></a>é€‰æ‹©æ€§å‡çº§ï¼ˆOpt-in Upgradesï¼‰</h2><p>å‡çº§å»ä¸­å¿ƒåŒ–çš„æŠ—å®¡æŸ¥æ™ºèƒ½åˆçº¦æ˜¯éå¸¸å›°éš¾çš„ã€‚å¸Œæœ› Uniswap 1.0 å·²ç»æ˜¯å®Œç¾çš„ï¼Œä½†å®ƒå¯èƒ½å¹¶éå¦‚æ­¤ã€‚å¦‚æœå‡ºç°æ”¹è¿›ç‰ˆçš„ Uniswap 2.0 è®¾è®¡ï¼Œå¯ä»¥éƒ¨ç½²æ–°çš„å·¥å‚åˆçº¦ã€‚æµåŠ¨æ€§æä¾›è€…å¯ä»¥é€‰æ‹©è¿ç§»åˆ°æ–°çš„ç³»ç»Ÿï¼Œæˆ–è€…ç»§ç»­ä½¿ç”¨æ—§çš„ç³»ç»Ÿã€‚</p>
<p><code>tokenToExchange</code> å‡½æ•°ä½¿å¾—è·¨ä¸åŒå·¥å‚å¯åŠ¨çš„äº¤æ˜“æ‰€ä¹‹é—´çš„äº¤æ˜“æˆä¸ºå¯èƒ½ã€‚è¿™å¯ä»¥ç”¨äºå‘åå…¼å®¹ã€‚ERC20 åˆ° ERC20 çš„äº¤æ˜“å°†åœ¨ä½¿ç”¨ <code>tokenToToken</code> å’Œ <code>tokenToExchange</code> å‡½æ•°çš„ç‰ˆæœ¬ä¹‹é—´è¿›è¡Œã€‚ç„¶è€Œï¼Œè·¨ç‰ˆæœ¬çš„äº¤æ˜“åªä¼šä½¿ç”¨ <code>tokenToExchange</code> å‡½æ•°ã€‚æ‰€æœ‰å‡çº§éƒ½æ˜¯é€‰æ‹©æ€§çš„ï¼Œå¹¶ä¸”æ˜¯å‘åå…¼å®¹çš„ã€‚ğŸ’–ğŸ’–ğŸ’–</p>
<hr>
<h2 id="å‰ç½®äº¤æ˜“ï¼ˆFrontrunningï¼‰"><a href="#å‰ç½®äº¤æ˜“ï¼ˆFrontrunningï¼‰" class="headerlink" title="å‰ç½®äº¤æ˜“ï¼ˆFrontrunningï¼‰"></a>å‰ç½®äº¤æ˜“ï¼ˆFrontrunningï¼‰</h2><p>Uniswap åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è¢«å‰ç½®äº¤æ˜“ï¼ˆfrontrunï¼‰ã€‚è¿™å—é™äºç”¨æˆ·è®¾ç½®çš„æœ€å°&#x2F;æœ€å¤§å€¼å’Œäº¤æ˜“æˆªæ­¢æ—¶é—´ã€‚</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2024/11/29/uniswap-v1-ill-deep/">â† ä¸‹ä¸€ç¯‡ Uniswap V1--æ·±åº¦æ¢ç´¢</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2024/11/26/Uniswap_v1_ill/">Uniswap V1--ç®€å•ä»‹ç» ä¸Šä¸€ç¯‡ â†’</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="å›åˆ°é¡¶éƒ¨" style="opacity: 0; display: none;">âˆ§ </a><a class="i-index" id="to-index" href="#toc-div" title="æ–‡ç« ç›®å½•">â‰¡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="åˆ‡æ¢ä¸»é¢˜"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/1.png" alt="Logo"></a><h1 id="Dr"><a>0xOne1eaF</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>ç›®å½•</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Uniswap-whitepaper"><span class="toc-number">1.</span> <span class="toc-text">Uniswap whitepaper</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Gas-%E5%9F%BA%E5%87%86%EF%BC%88Gas-Benchmarks%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">Gas åŸºå‡†ï¼ˆGas Benchmarksï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A4%E6%98%93%E5%B9%B3%E5%8F%B0-Gas-%E6%B6%88%E8%80%97%E5%AF%B9%E6%AF%94%E8%A1%A8"><span class="toc-number">1.1.0.1.</span> <span class="toc-text">äº¤æ˜“å¹³å° Gas æ¶ˆè€—å¯¹æ¯”è¡¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BA%A4%E6%98%93%E5%AF%B9%EF%BC%88Creating-Exchanges%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">åˆ›å»ºäº¤æ˜“å¯¹ï¼ˆCreating Exchangesï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">æ ¸å¿ƒä»£ç ç¤ºä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ETH-%E2%87%84-ERC20-%E4%BA%A4%E6%98%93%EF%BC%88ETH-to-ERC20-Trades%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">ETH â‡„ ERC20 äº¤æ˜“ï¼ˆETH to ERC20 Tradesï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ETH-%E8%BD%AC-ERC20-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">ETH è½¬ ERC20 ç¤ºä¾‹ä»£ç </span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ERC20-%E8%BD%AC-ETH-%E4%BA%A4%E6%98%93%EF%BC%88ERC20-to-ETH-Trades%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">ERC20 è½¬ ETH äº¤æ˜“ï¼ˆERC20 to ETH Tradesï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ETH-%E5%88%B0-OMG-%E7%A4%BA%E4%BE%8B%E4%BA%A4%E6%98%93"><span class="toc-number">1.4.1.</span> <span class="toc-text">ETH åˆ° OMG ç¤ºä¾‹äº¤æ˜“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ERC20-%E2%87%84-ERC20-%E4%BA%A4%E6%98%93"><span class="toc-number">1.5.</span> <span class="toc-text">ERC20 â‡„ ERC20 äº¤æ˜“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A4%E6%8D%A2%E4%B8%8E%E8%BD%AC%E8%B4%A6"><span class="toc-number">1.6.</span> <span class="toc-text">äº¤æ¢ä¸è½¬è´¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E4%BE%9B%E6%B5%81%E5%8A%A8%E6%80%A7"><span class="toc-number">1.7.</span> <span class="toc-text">æä¾›æµåŠ¨æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%B5%81%E5%8A%A8%E6%80%A7"><span class="toc-number">1.7.1.</span> <span class="toc-text">æ·»åŠ æµåŠ¨æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E5%8A%A8%E6%80%A7%E4%BB%A3%E5%B8%81"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">æµåŠ¨æ€§ä»£å¸</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E6%B5%81%E5%8A%A8%E6%80%A7"><span class="toc-number">1.7.2.</span> <span class="toc-text">ç§»é™¤æµåŠ¨æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E5%8A%A8%E6%80%A7%E4%BB%A3%E5%B8%81-1"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">æµåŠ¨æ€§ä»£å¸</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%B9%E7%94%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.8.</span> <span class="toc-text">è´¹ç”¨ç»“æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B1%A0"><span class="toc-number">1.9.</span> <span class="toc-text">è‡ªå®šä¹‰æ± </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ERC20-%E5%88%B0%E4%BA%A4%E6%98%93%E6%89%80"><span class="toc-number">1.9.1.</span> <span class="toc-text">ERC20 åˆ°äº¤æ˜“æ‰€</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E6%80%A7%E5%8D%87%E7%BA%A7%EF%BC%88Opt-in-Upgrades%EF%BC%89"><span class="toc-number">1.10.</span> <span class="toc-text">é€‰æ‹©æ€§å‡çº§ï¼ˆOpt-in Upgradesï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BA%A4%E6%98%93%EF%BC%88Frontrunning%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">å‰ç½®äº¤æ˜“ï¼ˆFrontrunningï¼‰</span></a></li></ol></li></ol></div></div><footer><nobr>æ„å»ºè‡ª <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> ä½¿ç”¨ä¸»é¢˜ <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> ä¸»é¢˜ä½œè€… <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>